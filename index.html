<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Leaflet Map Diagnostic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:,">

  <!-- Leaflet CSS (two CDNs; either can work) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">

  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0b1020; color:#e8ecf8; }
    header { padding:10px 14px; border-bottom:1px solid #ffffff22; }
    #status { margin:10px 14px; padding:8px 10px; background:#132046; border:1px solid #2b4dd8; border-radius:8px; }
    #map { height: calc(100vh - 120px); margin:14px; border:3px dashed #6aa6ff; border-radius:10px; }
    a { color:#6aa6ff; }
  </style>

  <!-- Leaflet JS (two CDNs; second acts as fallback if the first was blocked) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
  <script>
    // If unpkg was blocked, try jsDelivr by dynamically injecting it
    if (typeof window.L === 'undefined') {
      var s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js';
      s.crossOrigin = 'anonymous';
      document.head.appendChild(s);
    }
  </script>
</head>
<body>
  <header>
    <strong>Leaflet Map Diagnostic</strong> — checks CSS, JS, and tile loading.
  </header>

  <div id="status">Loading…</div>
  <div id="map"></div>

  <script>
    (async function () {
      const statusEl = document.getElementById('status');

      // Wait a tick to allow the fallback script to load if needed
      await new Promise(r => setTimeout(r, 300));

      if (typeof window.L === 'undefined') {
        statusEl.innerHTML = "❌ Leaflet JS didn't load. A CDN may be blocked. \
Try a different network, or we can switch to a self-hosted Leaflet file.";
        return;
      }

      try {
        statusEl.textContent = '✅ Leaflet loaded. Initializing map…';

        const map = L.map('map').setView([-36.8485, 174.7633], 12); // Auckland
        const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // If tiles fail due to network/CDN, listen for error
        tiles.on('tileerror', function (e) {
          statusEl.innerHTML = "⚠️ Map container is OK, but OSM tiles failed to load (network or CDN blockage). \
The map may appear blank/grey. If so, try a different connection, or we can switch to another free tile server.";
        });

        L.marker([-36.8485, 174.7633]).addTo(map).bindPopup('Auckland CBD').openPopup();

        statusEl.innerHTML = '✅ Map is live. You should see a blue dashed box with a map and a marker.';
      } catch (err) {
        statusEl.innerHTML = '❌ Error during map init: ' + (err && err.message ? err.message : String(err));
        console.error(err);
      }
    })();
  </script>
</body>
</html>
